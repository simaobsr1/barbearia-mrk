<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Agendamento - Barbearia MRK</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="bg-dark text-white">
    <div class="container py-5">
        <div class="text-center mb-4">
            <img src="{{ url_for('static', filename='logo.JPG.jpeg') }}" alt="Logo Barbearia MRK"
                style="max-width: 200px;">
            <h2 class="mt-3">Agende seu hor√°rio</h2>
            <p>Escolha o servi√ßo, dia e hor√°rio desejado</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} text-center">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="row">
            <div class="col-md-7">
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label">Nome</label>
                        <input type="text" name="nome" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Telefone</label>
                        <input type="text" name="telefone" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Data</label>
                        <input type="date" name="data" class="form-control" min="{{ current_date }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Hor√°rio</label>
                        <select name="horario" id="horario" class="form-select" required>
                            <option value="">Selecione uma data</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Servi√ßo</label>
                        <select name="servico" class="form-select" required>
                            <option value="">Escolha o servi√ßo</option>
                            <option value="Corte Navalhado - R$30">Corte Navalhado</option>
                            <option value="Corte Social - R$25">Corte Social</option>
                            <option value="Barba - R$15">Barba</option>
                            <option value="Barba + Corte - R$40">Barba + Corte</option>
                            <option value="Sobrancelhas - R$10">Sobrancelhas</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-danger w-100">Agendar</button>
                </form>
            </div>

            <div class="col-md-5">
                <h5 class="text-center">üíà Tabela de Pre√ßos</h5>
                <ul class="list-group text-dark">
                    <li class="list-group-item">Corte Navalhado ‚Äì R$30</li>
                    <li class="list-group-item">Corte Social ‚Äì R$25</li>
                    <li class="list-group-item">Barba ‚Äì R$15</li>
                    <li class="list-group-item">Barba + Corte ‚Äì R$40</li>
                    <li class="list-group-item">Sobrancelhas ‚Äì R$10</li>
                </ul>
            </div>
        </div>
    </div>

    <nav class="position-absolute top-0 end-0 m-3">
        {% if session.get('logado') %}
        <a href="/agendamentos-dia" class="btn btn-outline-light btn-sm me-1">üìã Agendamentos</a>
        <a href="/faturamento" class="btn btn-outline-light btn-sm me-1">üí∞ Faturamento</a>
        <a href="/logout" class="btn btn-outline-danger btn-sm">Sair</a>
        {% else %}
        <a href="/login" class="btn btn-outline-light btn-sm">üîí √Årea Administrativa</a>
        {% endif %}
    </nav>

    <script>
        document.querySelector('input[name="data"]').addEventListener('change', function () {
            const dataSelecionada = this.value;
            const horarioSelect = document.getElementById("horario");
            horarioSelect.innerHTML = '<option>Carregando hor√°rios...</option>';

            fetch(`/horarios-disponiveis?data=${dataSelecionada}`)
                .then(res => res.json())
                .then(data => {
                    horarioSelect.innerHTML = '';
                    data.todos.forEach(hora => {
                        const option = document.createElement('option');
                        option.value = hora;
                        option.textContent = hora;

                        if (data.ocupados.includes(hora)) {
                            option.disabled = true;
                            option.textContent += " (Indispon√≠vel)";
                            option.style.color = "#888";
                        }

                        horarioSelect.appendChild(option);
                    });
                });
        });
    </script>

</body>

</html>